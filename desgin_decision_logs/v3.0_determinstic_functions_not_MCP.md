# v3: Deterministic fucntion calling: 
In v2.0_function_calls_MCP.md, the idea was to have the users pre-processed-query handed over to my MCP Clinet/Server in to decide which tools to call for the querying my database. 

However after inspecting the space of possible params that could be extracted, it seems the tools calls are largely detemrtinstic: 

If intent is understood as what to do with a given set of params extracted from a users query, then if for a given "intent" the number of tools to call == 1 the outcome is determined, and MCP is laible to mistakes that conventioanl logic wouldn;t make: 

i.e |valid_tools(intent)| == 1 --> NO MCP

MCP would be useful in cases where a given intent needs further resolution, e.g. deciding which dates correspond to which films/cinemas in cases where multiple are given. 

As seen in Fig.1, for the moment, it seems each set possble set of params only has one outcome, and so I will not use my MCP set up (yet!): 

## Fig.1: 


| Existing Cinema specifed | Existing film specifed | Date range specified | computation to perform.                              | Example Q:                        |
| ------------------------ | ---------------------- | -------------------- | ---------------------------------------------------- | --------------------------------- |
| yes                      | yes                    | yes                  | get_specific_showtimes(cinema, dates, film)          | Is Star Wars at BFI today?        |
| yes                      | yes                    | no                   | get_all_screenings_at_cinema_on_dates(cinema, dates) | what is on at BFI tody            |
| yes                      | no                     | yes                  | get_dates_for_film_at_cinema(cinema, film)           | when is star wars at BFI?         |
| yes                      | no                     | no                   | get_all_listings_for_cinema(cinema)                  | What is on at BFI                 |
| no                       | yes                    | yes                  | get_ciemas_for_film_and_dates(film, dates)           | Where is showing Star wars today? |
| no                       | yes                    | no                   | get_all_cinemas_listings_on_dates(dates)             | Whats on today?                   |
| no                       | no                     | yes                  | get_screenigns_for_film(film)                        | Where can I watch StarWars?       |
| no                       | no                     | no                   | handle_no_params_from_user()                         | What Can this app do?             |


- Existing Cinema: see cinemas in kl_mcp_rag/constants_and_types/listings.py
- Existing film: Films stored in my raw listings (embedded into VectorDB)

There are also the following potential cases that will be handled pre fig.1: 

Matched Films: 

| user specifed film | specifed film matched  against vDB | outcome:                                     |
| ------------------ | ---------------------------------- | -------------------------------------------- |
| yes                | yes                                | Query refers to film in DB --> Fig.1 actions |
| yes                | no                                 | Q about non-existant film -> [001]           |
| no                 | yes                                | N/A --> would be error in code               |
| no                 | no                                 | Query not include film --> Fig.1 actions     |

Matched Cinema:

| user specifed cinema | specifed cinema in list of allowed cinemas? | outcome:                                       |
| -------------------- | ------------------------------------------- | ---------------------------------------------- |
| yes                  | yes                                         | Query refers to valid cinema --> Fig.1 actions |
| yes                  | no                                          | Q about non-existant cinema -> [002]           |
| no                   | yes                                         | N/A                                            |
| no                   | no                                          | Query not include cinema --> Fig.1 actions     |

[001] user feedback e.g. "Film is not screening anywhere" --> no need for look up
[002] user feedback e.g. "Cinema not on KL" --> no need for look up

----

# CORRECTION: 
NOTE: behaviour in my system is that any query with c = _ -> all cinemas
therefore queries map as follws:
_fD -> cfd ;  __d -> c_d ;  _f_ -> cf_

after thought, this is expected behaviour, and conveniently simplifes backend logic :)

null case _ _ _ therefore maps to c__ ;
but this will be caught in pre processor  #TODO: if no cinema, no date, no film -> raise eroror and give user fb